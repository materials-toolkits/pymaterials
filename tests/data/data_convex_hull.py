import torch
from pymatgen.core import Composition, Element
from materials_toolkit.data import StructureData, HDF5Dataset

import os

entries = [
    ("Li5FeO4", -1.997, 0.0),
    ("Fe3O4", -1.661, 0.0),
    ("Li2FeO2", -1.873, 0.0),
    ("LiO3", -0.919, 0.0),
    ("Li3FeO4", -1.796, 0.0),
    ("Li2FeO3", -1.844, 0.003),
    ("Fe", 0.0, 0.0),
    ("LiO", -1.621, 0.0),
    ("LiO2", -1.192, 0.0),
    ("FeO", -1.543, 0.0),
    ("Li", 0.0, 0.0),
    ("LiFeO2", -1.931, 0.0),
    ("O", 0.0, 0.0),
    ("Fe2O3", -1.65, 0.0),
    ("Li2O", -1.98, 0.0),
    ("LiFeO2", -1.931, 0.0),
    ("Li5FeO4", -1.997, 0.0),
    ("Li2FeO2", -1.873, 0.0),
    ("Li3FeO4", -1.796, 0.0),
    ("Li2FeO3", -1.844, 0.003),
    ("Li2FeO3", -1.843, 0.003),
    ("Li2FeO3", -1.843, 0.003),
    ("LiFeO2", -1.927, 0.004),
    ("Li6Fe2O7", -1.877, 0.006),
    ("LiFe5O8", -1.723, 0.007),
    ("LiFe2O4", -1.687, 0.008),
    ("LiFeO2", -1.92, 0.011),
    ("Li39Fe8O32", -1.971, 0.015),
    ("Li39Fe8O32", -1.971, 0.015),
    ("Li39Fe8O32", -1.97, 0.016),
    ("Li39Fe8O32", -1.97, 0.016),
    ("Li39Fe8O32", -1.97, 0.017),
    ("Li5FeO4", -1.978, 0.019),
    ("Li39Fe8O32", -1.967, 0.02),
    ("Li8Fe4O11", -1.881, 0.02),
    ("Li4FeO4", -1.885, 0.023),
    ("LiFeO2", -1.904, 0.026),
    ("LiFeO2", -1.904, 0.026),
    ("LiFeO2", -1.904, 0.027),
    ("Li4FeO3", -1.883, 0.031),
    ("Li8Fe4O11", -1.869, 0.032),
    ("LiFeO2", -1.895, 0.036),
    ("LiFeO2", -1.895, 0.036),
    ("LiFeO2", -1.894, 0.036),
    ("LiFeO2", -1.894, 0.037),
    ("Li8FeO6", -1.893, 0.05),
    ("Li3FeO4", -1.746, 0.05),
    ("LiFeO2", -1.88, 0.051),
    ("Li6FeO6", -1.764, 0.055),
    ("Li4Fe2O5", -1.902, 0.059),
    ("Li3Fe2O6", -1.668, 0.061),
    ("Li4FeO4", -1.843, 0.064),
    ("Li3Fe2O6", -1.662, 0.067),
    ("Li5FeO4", -1.929, 0.068),
    ("Li4FeO5", -1.691, 0.07),
    ("Li7FeO6", -1.819, 0.07),
    ("Li6Fe4O11", -1.724, 0.077),
    ("Li3Fe2O6", -1.649, 0.08),
    ("Li2FeO2", -1.79, 0.083),
    ("LiFeO3", -1.465, 0.086),
    ("LiFeO2", -1.845, 0.086),
    ("LiFeO3", -1.465, 0.086),
    ("Li3FeO4", -1.708, 0.088),
    ("Li6Fe4O11", -1.71, 0.09),
    ("LiFeO2", -1.823, 0.108),
    ("Li6Fe4O11", -1.693, 0.108),
    ("Li3Fe2O4", -1.787, 0.112),
    ("LiFeO3", -1.433, 0.117),
    ("LiFeO3", -1.433, 0.118),
    ("LiFeO3", -1.431, 0.12),
    ("LiFeO3", -1.429, 0.122),
    ("Li3Fe2O6", -1.596, 0.134),
    ("Li6Fe4O11", -1.659, 0.142),
    ("LiFeO4", -1.143, 0.154),
    ("LiFeO2", -1.738, 0.192),
    ("LiFeO3", -1.354, 0.196),
    ("Li2FeO4", -1.401, 0.214),
    ("LiFeO3", -1.332, 0.218),
    ("Li2Fe2O5", -1.466, 0.253),
    ("LiFe2O6", -1.054, 0.271),
    ("LiFeO2", -1.659, 0.272),
    ("LiFe2O6", -1.052, 0.273),
    ("LiFe2O6", -1.029, 0.296),
    ("LiFeO3", -1.236, 0.314),
    ("LiFeO3", -1.175, 0.376),
    ("LiFeO4", -0.919, 0.378),
    ("LiFeO3", -1.172, 0.379),
    ("LiFeO2", -1.486, 0.445),
    ("LiFeO4", -0.788, 0.509),
    ("LiFeO4", -0.634, 0.663),
    ("Li2Fe2O5", -1.008, 0.711),
    ("LiFeO3", -0.759, 0.792),
    ("LiFeO3", -0.362, 1.188),
    ("LiFe7", 0.19, 0.19),
    ("LiFe3", 0.216, 0.216),
    ("LiFe3", 0.22, 0.22),
    ("Li2Fe", 0.232, 0.232),
    ("LiFe", 0.233, 0.233),
    ("LiFe3", 0.235, 0.235),
    ("LiFe", 0.236, 0.236),
    ("LiFe3", 0.237, 0.237),
    ("Li2Fe", 0.254, 0.254),
    ("LiFe3", 0.257, 0.257),
    ("LiFe2", 0.267, 0.267),
    ("Li9Fe4", 0.28, 0.28),
    ("Li2Fe5", 0.296, 0.296),
    ("LiFe", 0.303, 0.303),
    ("Li3Fe2", 0.309, 0.309),
    ("LiFe", 0.31, 0.31),
    ("LiFe5", 0.314, 0.314),
    ("LiFe", 0.368, 0.368),
    ("Li3Fe", 0.39, 0.39),
    ("Li3Fe", 0.397, 0.397),
    ("Li3Fe", 0.409, 0.409),
    ("Li3Fe", 0.414, 0.414),
    ("Li2Fe", 0.483, 0.483),
    ("LiFe", 0.483, 0.483),
    ("LiFe", 0.966, 0.966),
    ("Li3Fe2", 0.969, 0.969),
    ("LiFe2", 1.149, 1.149),
    ("LiFe", 1.717, 1.717),
    ("FeO", -1.543, 0.0),
    ("Fe2O3", -1.65, 0.0),
    ("Fe3O4", -1.661, 0.0),
    ("FeO", -1.54, 0.003),
    ("FeO", -1.531, 0.012),
    ("Fe2O3", -1.637, 0.013),
    ("Fe2O3", -1.635, 0.015),
    ("Fe2O3", -1.635, 0.015),
    ("Fe2O3", -1.635, 0.015),
    ("FeO", -1.527, 0.016),
    ("Fe3O4", -1.644, 0.017),
    ("FeO", -1.524, 0.019),
    ("Fe3O5", -1.525, 0.021),
    ("FeO", -1.52, 0.023),
    ("Fe3O4", -1.637, 0.023),
    ("FeO", -1.519, 0.024),
    ("FeO", -1.519, 0.025),
    ("Fe3O4", -1.632, 0.029),
    ("Fe3O4", -1.63, 0.031),
    ("Fe3O4", -1.629, 0.032),
    ("FeO", -1.508, 0.035),
    ("Fe2O3", -1.613, 0.037),
    ("FeO", -1.505, 0.038),
    ("Fe3O4", -1.619, 0.042),
    ("Fe3O4", -1.619, 0.042),
    ("Fe3O4", -1.616, 0.045),
    ("FeO", -1.498, 0.045),
    ("Fe3O4", -1.615, 0.045),
    ("Fe3O4", -1.614, 0.047),
    ("Fe3O4", -1.609, 0.051),
    ("Fe2O3", -1.593, 0.057),
    ("Fe3O4", -1.604, 0.057),
    ("Fe2O3", -1.59, 0.06),
    ("FeO", -1.483, 0.06),
    ("Fe5O8", -1.525, 0.062),
    ("Fe4O7", -1.437, 0.063),
    ("Fe4O5", -1.571, 0.064),
    ("Fe7O9", -1.576, 0.07),
    ("Fe4O5", -1.563, 0.071),
    ("FeO2", -1.302, 0.072),
    ("FeO2", -1.302, 0.073),
    ("FeO2", -1.302, 0.073),
    ("Fe3O4", -1.587, 0.074),
    ("Fe4O5", -1.559, 0.076),
    ("FeO2", -1.293, 0.081),
    ("Fe3O4", -1.573, 0.087),
    ("Fe3O4", -1.572, 0.089),
    ("FeO", -1.448, 0.096),
    ("FeO2", -1.278, 0.097),
    ("Fe2O3", -1.548, 0.101),
    ("Fe2O3", -1.542, 0.108),
    ("FeO2", -1.265, 0.11),
    ("Fe2O3", -1.54, 0.11),
    ("FeO2", -1.261, 0.114),
    ("Fe2O3", -1.536, 0.114),
    ("FeO", -1.427, 0.116),
    ("Fe5O7", -1.539, 0.117),
    ("FeO", -1.423, 0.12),
    ("Fe4O5", -1.504, 0.131),
    ("FeO4", -0.693, 0.132),
    ("FeO2", -1.241, 0.134),
    ("FeO", -1.408, 0.135),
    ("FeO", -1.408, 0.135),
    ("Fe3O7", -1.1, 0.137),
    ("FeO", -1.404, 0.139),
    ("Fe2O3", -1.509, 0.141),
    ("Fe2O3", -1.505, 0.145),
    ("Fe3O4", -1.513, 0.148),
    ("FeO2", -1.227, 0.148),
    ("Fe2O3", -1.501, 0.149),
    ("FeO", -1.386, 0.157),
    ("Fe2O3", -1.491, 0.159),
    ("FeO", -1.379, 0.164),
    ("Fe2O3", -1.486, 0.164),
    ("Fe2O3", -1.484, 0.166),
    ("Fe2O3", -1.484, 0.166),
    ("FeO", -1.372, 0.171),
    ("FeO3", -0.856, 0.175),
    ("FeO", -1.365, 0.178),
    ("FeO", -1.351, 0.192),
    ("FeO", -1.348, 0.195),
    ("FeO3", -0.833, 0.198),
    ("Fe4O11", -0.901, 0.199),
    ("FeO", -1.344, 0.199),
    ("FeO3", -0.824, 0.207),
    ("FeO3", -0.821, 0.21),
    ("FeO4", -0.61, 0.215),
    ("FeO", -1.324, 0.219),
    ("Fe13O19", -1.426, 0.227),
    ("FeO2", -1.145, 0.23),
    ("FeO3", -0.798, 0.233),
    ("FeO2", -1.134, 0.241),
    ("Fe4O11", -0.854, 0.246),
    ("FeO3", -0.776, 0.255),
    ("FeO2", -1.108, 0.267),
    ("FeO4", -0.554, 0.27),
    ("FeO", -1.266, 0.277),
    ("Fe2O3", -1.372, 0.277),
    ("FeO3", -0.737, 0.294),
    ("FeO", -1.234, 0.309),
    ("FeO", -1.23, 0.313),
    ("FeO", -1.226, 0.317),
    ("FeO3", -0.713, 0.319),
    ("FeO2", -1.055, 0.319),
    ("FeO2", -1.055, 0.32),
    ("FeO2", -1.049, 0.325),
    ("FeO", -1.217, 0.326),
    ("FeO", -1.217, 0.326),
    ("FeO", -1.216, 0.327),
    ("Fe3O2", -0.892, 0.342),
    ("FeO", -1.173, 0.37),
    ("FeO3", -0.646, 0.385),
    ("FeO", -1.154, 0.389),
    ("Fe4O11", -0.707, 0.393),
    ("Fe2O", -0.602, 0.427),
    ("Fe4O5", -1.2, 0.434),
    ("Fe4O11", -0.657, 0.443),
    ("Fe2O5", -0.73, 0.449),
    ("Fe2O", -0.571, 0.458),
    ("FeO4", -0.361, 0.464),
    ("Fe4O11", -0.631, 0.469),
    ("FeO3", -0.561, 0.471),
    ("FeO3", -0.559, 0.472),
    ("FeO3", -0.552, 0.479),
    ("Fe2O3", -1.17, 0.48),
    ("Fe2O5", -0.693, 0.485),
    ("Fe4O11", -0.601, 0.499),
    ("FeO3", -0.529, 0.502),
    ("FeO3", -0.522, 0.509),
    ("FeO", -1.018, 0.525),
    ("FeO3", -0.495, 0.536),
    ("Fe3O", -0.224, 0.547),
    ("FeO3", -0.475, 0.556),
    ("Fe3O2", -0.678, 0.556),
    ("Fe2O", -0.425, 0.603),
    ("Fe2O", -0.423, 0.606),
    ("FeO4", -0.208, 0.617),
    ("FeO4", -0.202, 0.622),
    ("FeO4", -0.202, 0.623),
    ("Fe8O", 0.284, 0.627),
    ("Fe3O4", -1.033, 0.628),
    ("Fe9O", 0.339, 0.647),
    ("FeO4", -0.158, 0.667),
    ("FeO3", -0.359, 0.672),
    ("Fe2O3", -0.936, 0.714),
    ("Fe2O3", -0.927, 0.722),
    ("FeO3", -0.297, 0.734),
    ("FeO", -0.796, 0.747),
    ("Fe3O4", -0.836, 0.824),
    ("FeO3", -0.17, 0.861),
    ("FeO3", -0.143, 0.889),
    ("Fe2O5", -0.168, 1.011),
    ("Fe3O", 0.288, 1.059),
    ("Fe3O", 0.293, 1.064),
    ("Fe3O", 0.296, 1.068),
    ("Fe3O4", -0.524, 1.137),
    ("Fe2O", 0.118, 1.147),
    ("FeO3", 0.176, 1.207),
    ("FeO3", 0.218, 1.249),
    ("FeO3", 0.225, 1.257),
    ("Fe3O", 0.602, 1.374),
    ("Fe5O", 0.99, 1.504),
    ("Fe2O", 0.617, 1.645),
    ("FeO2", 0.658, 2.033),
    ("Fe3O2", 2.846, 4.08),
    ("Li2O", -1.98, 0.0),
    ("LiO2", -1.192, 0.0),
    ("LiO", -1.621, 0.0),
    ("LiO3", -0.919, 0.0),
    ("Li2O", -1.979, 0.0),
    ("Li2O", -1.979, 0.001),
    ("LiO2", -1.19, 0.002),
    ("LiO3", -0.865, 0.054),
    ("Li2O", -1.921, 0.059),
    ("Li2O", -1.919, 0.061),
    ("Li2O", -1.893, 0.087),
    ("Li2O", -1.892, 0.087),
    ("LiO", -1.509, 0.112),
    ("LiO", -1.477, 0.144),
    ("Li2O", -1.833, 0.146),
    ("LiO", -1.469, 0.152),
    ("Li2O", -1.826, 0.154),
    ("LiO", -1.463, 0.158),
    ("Li8O7", -1.519, 0.173),
    ("Li2O", -1.791, 0.188),
    ("Li4O5", -1.276, 0.202),
    ("Li4O3", -1.549, 0.226),
    ("Li2O", -1.706, 0.274),
    ("Li2O", -1.689, 0.29),
    ("LiO", -1.314, 0.307),
    ("Li2O", -1.671, 0.308),
    ("Li3O", -1.173, 0.312),
    ("Li2O", -1.644, 0.336),
    ("Li6O5", -1.369, 0.35),
    ("LiO", -1.204, 0.417),
    ("LiO", -1.184, 0.437),
    ("LiO", -1.171, 0.449),
    ("LiO", -1.143, 0.477),
    ("LiO", -1.141, 0.48),
    ("LiO3", -0.438, 0.481),
    ("Li3O", -0.833, 0.652),
    ("LiO", -0.944, 0.676),
    ("Li3O", -0.681, 0.804),
    ("Li3O", -0.671, 0.813),
    ("Li2O3", -0.512, 0.851),
    ("Li3O4", -0.516, 0.921),
    ("LiO2", -0.253, 0.939),
    ("LiO3", 0.089, 1.008),
    ("Li2O3", -0.32, 1.044),
    ("LiO2", -0.117, 1.075),
    ("Li5O", 0.098, 1.087),
    ("LiO3", 0.24, 1.159),
    ("LiO3", 0.302, 1.221),
    ("Li2O", -0.695, 1.285),
    ("LiO5", 0.691, 1.303),
    ("LiO3", 0.473, 1.392),
    ("Li2O", -0.315, 1.665),
    ("LiO2", 0.604, 1.796),
    ("Fe", 0.0, 0.0),
    ("Fe", 0.0, 0.0),
    ("Fe", 0.0, 0.0),
    ("Fe", 0.0, 0.0),
    ("Fe", 0.0, 0.0),
    ("Fe", 0.002, 0.002),
    ("Fe", 0.018, 0.018),
    ("Fe", 0.086, 0.086),
    ("Fe", 0.088, 0.088),
    ("Fe", 0.089, 0.089),
    ("Fe", 0.112, 0.112),
    ("Fe", 0.129, 0.129),
    ("Fe", 0.138, 0.138),
    ("Fe", 0.161, 0.161),
    ("Fe", 0.169, 0.169),
    ("Fe", 0.175, 0.175),
    ("Fe", 0.176, 0.176),
    ("Fe", 0.177, 0.177),
    ("Fe", 0.181, 0.181),
    ("Fe", 0.182, 0.182),
    ("Fe", 0.189, 0.189),
    ("Fe", 0.198, 0.198),
    ("Fe", 0.198, 0.198),
    ("Fe", 0.198, 0.198),
    ("Fe", 0.348, 0.348),
    ("Fe", 0.366, 0.366),
    ("Fe", 0.499, 0.499),
    ("Fe", 0.517, 0.517),
    ("Fe", 0.638, 0.638),
    ("Fe", 0.76, 0.76),
    ("Fe", 1.059, 1.059),
    ("Fe", 1.244, 1.244),
    ("Li", 0.0, 0.0),
    ("Li", 0.001, 0.001),
    ("Li", 0.002, 0.002),
    ("Li", 0.002, 0.002),
    ("Li", 0.003, 0.003),
    ("Li", 0.004, 0.004),
    ("Li", 0.005, 0.005),
    ("Li", 0.005, 0.005),
    ("Li", 0.005, 0.005),
    ("Li", 0.005, 0.005),
    ("Li", 0.005, 0.005),
    ("Li", 0.005, 0.005),
    ("Li", 0.006, 0.006),
    ("Li", 0.007, 0.007),
    ("Li", 0.009, 0.009),
    ("Li", 0.018, 0.018),
    ("Li", 0.02, 0.02),
    ("Li", 0.021, 0.021),
    ("Li", 0.021, 0.021),
    ("Li", 0.021, 0.021),
    ("Li", 0.023, 0.023),
    ("Li", 0.024, 0.024),
    ("Li", 0.027, 0.027),
    ("Li", 0.029, 0.029),
    ("Li", 0.053, 0.053),
    ("Li", 0.053, 0.053),
    ("Li", 0.07, 0.07),
    ("Li", 0.079, 0.079),
    ("Li", 0.089, 0.089),
    ("Li", 0.091, 0.091),
    ("Li", 0.106, 0.106),
    ("Li", 0.325, 0.325),
    ("Li", 0.553, 0.553),
    ("O", 0.0, 0.0),
    ("O", 0.064, 0.064),
    ("O", 0.07, 0.07),
    ("O", 0.072, 0.072),
    ("O", 0.076, 0.076),
    ("O", 0.082, 0.082),
    ("O", 0.087, 0.087),
    ("O", 0.091, 0.091),
    ("O", 0.092, 0.092),
    ("O", 0.096, 0.096),
    ("O", 0.098, 0.098),
    ("O", 0.11, 0.11),
    ("O", 0.149, 0.149),
    ("O", 0.36, 0.36),
    ("O", 0.396, 0.396),
    ("O", 0.444, 0.444),
    ("O", 0.487, 0.487),
    ("O", 0.737, 0.737),
    ("O", 0.973, 0.973),
    ("O", 1.323, 1.323),
    ("O", 1.395, 1.395),
    ("O", 1.49, 1.49),
    ("O", 1.494, 1.494),
    ("O", 1.664, 1.664),
    ("O", 1.7, 1.7),
    ("O", 1.731, 1.731),
    ("O", 1.748, 1.748),
    ("O", 1.785, 1.785),
    ("O", 1.895, 1.895),
    ("O", 1.986, 1.986),
    ("O", 2.39, 2.39),
    ("O", 2.562, 2.562),
    ("O", 2.578, 2.578),
]


def write_hdf5_dataset(path: str):
    structs = []
    for c, e, _ in entries:
        comp = Composition(c)
        z = []
        for sym, n in comp.as_dict().items():
            z.extend([Element(sym).Z] * int(n))
        z = torch.tensor(z, dtype=torch.long)
        e = torch.tensor([e], dtype=torch.float32)

        struct = StructureData(z=z, energy_pa=e)
        structs.append(struct)

    HDF5Dataset.create_dataset(os.path.join(path, "raw"), structs)


def get_e_above_hull():
    return torch.tensor([e for _, _, e in entries], dtype=torch.float32)
